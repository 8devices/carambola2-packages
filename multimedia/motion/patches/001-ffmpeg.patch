diff -x .svn -ruN motion-3.2.8.old/motion.c motion-3.2.8/motion.c
--- motion-3.2.8.old/motion.c	2007-03-31 12:54:31.000000000 +0200
+++ motion-3.2.8/motion.c	2007-03-31 13:08:27.000000000 +0200
@@ -1282,6 +1282,7 @@
 		 * httpd-control snaps are always enabled.
 		 */
 
+#ifdef HAVE_FFMPEG
 		/* time_current_frame is used both for snapshot and timelapse features */
 		time_current_frame = cnt->currenttime;
 
@@ -1291,7 +1292,7 @@
 			event(cnt, EVENT_IMAGE_SNAPSHOT, newimg, NULL, NULL, cnt->currenttime_tm);
 			cnt->snapshot = 0;
 		}
-
+#endif /* HAVE_FFMPEG */
 
 	/***** MOTION LOOP - TIMELAPSE FEATURE SECTION *****/
 
@@ -1366,9 +1367,9 @@
 			event(cnt, EVENT_TIMELAPSEEND, NULL, NULL, NULL, cnt->currenttime_tm);
 
 
+		time_last_frame = time_current_frame;
 #endif /* HAVE_FFMPEG */
 
-		time_last_frame = time_current_frame;
 
 
 	/***** MOTION LOOP - VIDEO LOOPBACK SECTION *****/

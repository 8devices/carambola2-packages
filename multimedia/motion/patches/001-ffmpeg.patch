Index: motion-3.2.9/motion.c
===================================================================
--- motion-3.2.9.orig/motion.c
+++ motion-3.2.9/motion.c
@@ -1285,6 +1285,7 @@ static void *motion_loop(void *arg)
 		 * httpd-control snaps are always enabled.
 		 */
 
+#ifdef HAVE_FFMPEG
 		/* time_current_frame is used both for snapshot and timelapse features */
 		time_current_frame = cnt->currenttime;
 
@@ -1294,7 +1295,7 @@ static void *motion_loop(void *arg)
 			event(cnt, EVENT_IMAGE_SNAPSHOT, newimg, NULL, NULL, cnt->currenttime_tm);
 			cnt->snapshot = 0;
 		}
-
+#endif /* HAVE_FFMPEG */
 
 	/***** MOTION LOOP - TIMELAPSE FEATURE SECTION *****/
 
@@ -1369,9 +1370,9 @@ static void *motion_loop(void *arg)
 			event(cnt, EVENT_TIMELAPSEEND, NULL, NULL, NULL, cnt->currenttime_tm);
 
 
+		time_last_frame = time_current_frame;
 #endif /* HAVE_FFMPEG */
 
-		time_last_frame = time_current_frame;
 
 
 	/***** MOTION LOOP - VIDEO LOOPBACK SECTION *****/

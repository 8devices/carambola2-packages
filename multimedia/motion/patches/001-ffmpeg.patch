Index: motion-3.2.7/motion.c
===================================================================
--- motion-3.2.7.orig/motion.c	2007-06-11 08:27:27.000000000 +0100
+++ motion-3.2.7/motion.c	2007-06-11 08:27:35.000000000 +0100
@@ -1279,6 +1279,7 @@
 		 * httpd-control snaps are always enabled.
 		 */
 
+#ifdef HAVE_FFMPEG
 		/* time_current_frame is used both for snapshot and timelapse features */
 		time_current_frame = cnt->currenttime;
 
@@ -1288,7 +1289,7 @@
 			event(cnt, EVENT_IMAGE_SNAPSHOT, newimg, NULL, NULL, cnt->currenttime_tm);
 			cnt->snapshot = 0;
 		}
-
+#endif /* HAVE_FFMPEG */
 
 	/***** MOTION LOOP - TIMELAPSE FEATURE SECTION *****/
 
@@ -1363,9 +1364,9 @@
 			event(cnt, EVENT_TIMELAPSEEND, NULL, NULL, NULL, cnt->currenttime_tm);
 
 
+		time_last_frame = time_current_frame;
 #endif /* HAVE_FFMPEG */
 
-		time_last_frame = time_current_frame;
 
 
 	/***** MOTION LOOP - VIDEO LOOPBACK SECTION *****/

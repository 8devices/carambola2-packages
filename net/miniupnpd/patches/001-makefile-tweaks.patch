--- miniupnpd-1.0-RC4/Makefile.openwrt.orig	2007-04-26 14:46:51.000000000 -0500
+++ miniupnpd-1.0-RC4/Makefile.openwrt	2007-04-26 14:52:55.000000000 -0500
@@ -2,7 +2,7 @@
 # http://miniupnp.free.fr/
 # Author : Thomas Bernard
 # for use with GNU Make
-include $(TOPDIR)/rules.mk
+
 #CFLAGS = -Wall -O -D_GNU_SOURCE -g
 #CFLAGS = -Wall -Os -D_GNU_SOURCE
 #CC = mipsel-linux-gcc
@@ -11,7 +11,7 @@
 CFLAGS += -D_GNU_SOURCE
 RM = rm -f
 INSTALL = install
-IPTABLESINC=$(BUILD_DIR)/iptables-1.3.3/include
+IPTABLESINC=$(STAGING_DIR)/usr/include
 
 BASEOBJS = miniupnpd.o upnphttp.o upnpdescgen.o upnpsoap.o \
            upnpreplyparse.o minixml.o \
@@ -20,8 +20,6 @@
 
 LNXOBJS = linux/getifstats.o linux/iptcrdr.o
 
-LIBS = $(BUILD_DIR)/iptables-1.3.3/libiptc/libiptc.a
-
 TESTUPNPDESCGENOBJS = testupnpdescgen.o upnpdescgen.o
 
 EXECUTABLES = miniupnpd testupnpdescgen
@@ -38,6 +36,7 @@
 	@echo no install for now...
 
 miniupnpd:	$(BASEOBJS) $(LNXOBJS) $(LIBS)
+	$(CC) $(CFLAGS) -o $@ $(BASEOBJS) $(LNXOBJS) $(LIBS)
 
 testupnpdescgen:	$(TESTUPNPDESCGENOBJS)
 
@@ -59,13 +58,14 @@
 upnphttp.o: upnphttp.h upnpdescgen.h miniupnpdpath.h upnpsoap.h
 upnpdescgen.o: upnpdescgen.h miniupnpdpath.h upnpglobalvars.h
 upnpsoap.o: upnpglobalvars.h upnphttp.h upnpsoap.h upnpreplyparse.h
-upnpsoap.o: upnpredirect.h openbsd/getifstats.h
+upnpsoap.o: upnpredirect.h getifstats.h
 upnpreplyparse.o: upnpreplyparse.h minixml.h
 minixml.o: minixml.h
 upnpredirect.o: upnpredirect.h upnpglobalvars.h openbsd/obsdrdr.h
 daemonize.o: daemonize.h
 upnpglobalvars.o: upnpglobalvars.h
-linux/getifstats.o: openbsd/getifstats.h
+linux/getifstats.o: getifstats.h
 linux/iptcrdr.o: linux/iptcrdr.h
 testupnpdescgen.o: upnpdescgen.h
 upnpdescgen.o: upnpdescgen.h miniupnpdpath.h upnpglobalvars.h
+upnppermissions.o: upnppermissions.c

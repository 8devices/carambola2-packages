#
# Copyright (C) 2006 OpenWrt.org
#
# This is free software, licensed under the GNU General Public License v2.
# See /LICENSE for more information.
#
# $Id$

include $(TOPDIR)/rules.mk

PKG_NAME:=ipkungfu
PKG_VERSION:=0.6.0
PKG_RELEASE:=1

PKG_SOURCE:=$(PKG_NAME)-$(PKG_VERSION).tar.gz
PKG_SOURCE_URL:=http://www.linuxkungfu.org/ipkungfu
PKG_MD5SUM:=a65b5e629a7e9ef00aaf20587d918e5f

PKG_BUILD_DIR:=$(BUILD_DIR)/$(PKG_NAME)-$(PKG_VERSION)
PKG_INSTALL_DIR:=$(PKG_BUILD_DIR)/ipkg-install

include $(INCLUDE_DIR)/package.mk

define Package/ipkungfu
  SECTION:=net
  CATEGORY:=Network
  TITLE:=IPKungFu is an iptables-based Linux firewall
  URL:=http://www.linuxkungfu.org/
  SUBMENU:=firewall
endef

define Package/ipkungfu/description
	IPKungFu is an iptables-based Linux firewall.
	It aims to simplify the configuration of Internet 
	connection sharing, port forwarding, and packet filtering.
endef

define Package/ipkungfu/conffiles
/etc/ipkungfu/accept_hosts.conf
/etc/ipkungfu/custom.conf
/etc/ipkungfu/forward.conf
/etc/ipkungfu/log.conf
/etc/ipkungfu/pre.conf
/etc/ipkungfu/services.conf
/etc/ipkungfu/advanced.conf
/etc/ipkungfu/deny_hosts.conf
/etc/ipkungfu/ipkungfu.conf
/etc/ipkungfu/post.conf
/etc/ipkungfu/redirect.conf
/etc/ipkungfu/vhosts.conf
endef

# uses GNU configure

define Build/Compile
	$(MAKE) -C $(PKG_BUILD_DIR) \
		DESTDIR="$(PKG_INSTALL_DIR)" \
		all install
endef

define Package/ipkungfu/install	
	$(INSTALL_DIR) $(1)/usr/sbin
	$(CP) $(PKG_BUILD_DIR)/dummy_server $(1)/usr/sbin/
	$(CP) $(PKG_BUILD_DIR)/ipkungfu $(1)/usr/sbin/
	$(INSTALL_DIR) $(1)/etc/ipkungfu/
	$(CP) $(PKG_BUILD_DIR)/files/conf/* $(1)/etc/ipkungfu/
endef

$(eval $(call BuildPackage,ipkungfu))
